# ============================================================================
# BACKEND ENVIRONMENT VARIABLES - CrimeWise AI Grading System
# ============================================================================
# 
# Copy this file to .env and fill in with your actual values
# Never commit .env file with real secrets
#

# ============================================================================
# DATABASE CONFIGURATION
# ============================================================================
# SQLite Cloud connection string
# Format: sqlitecloud://apikey@host:port/database?apikey=key
DB_URL=sqlitecloud://cxd2tnbwvk.g5.sqlite.cloud:8860/crimewise?apikey=euIjfRGcZnywBxr10nuXqdrk6BXamqJZvXRalZPVWVg

# ============================================================================
# AUTHENTICATION
# ============================================================================
# JWT secret for signing authentication tokens (generate a strong random string)
JWT_SECRET=your_jwt_secret_here_change_this

# ============================================================================
# GEMINI API KEYS
# ============================================================================
# CHATBOT KEY (single key, not rotated)
GEMINI_API_KEY=your_chatbot_gemini_api_key_here

# AI GRADER KEYS (6 keys for distributed grading, 8 RPM per key = 48 total RPM)
# These are rotated by apiKeyManager for load balancing
GEMINI_API_KEY_1=your_grader_key_1_here
GEMINI_API_KEY_2=your_grader_key_2_here
GEMINI_API_KEY_3=your_grader_key_3_here
GEMINI_API_KEY_4=your_grader_key_4_here
GEMINI_API_KEY_5=your_grader_key_5_here
GEMINI_API_KEY_6=your_grader_key_6_here

# Alternative: comma-separated list for grader keys (if using same keys)
# GRADER_API_KEYS=key1,key2,key3,key4,key5,key6

# ============================================================================
# AI WORKER CONFIGURATION
# ============================================================================
# Number of concurrent AI grading jobs (6 = one per API key)
# Increasing this beyond 6 may exceed rate limits
# Range: 1-6 (default: 6)
AI_WORKER_CONCURRENCY=6

# Polling interval in milliseconds (how often to check for pending jobs)
# Range: 1000-10000 (default: 2000)
AI_WORKER_POLL_MS=2000

# Maximum number of retry attempts for failed grading jobs
# Range: 1-5 (default: 3)
AI_WORKER_MAX_RETRIES=3

# ============================================================================
# EMAIL CONFIGURATION (Optional)
# ============================================================================
# SMTP service for sending emails
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your_email@gmail.com
SMTP_PASSWORD=your_app_password

# Email sender address
EMAIL_FROM=noreply@crimewise.com

# ============================================================================
# NODE ENVIRONMENT
# ============================================================================
# Set to 'production' in Vercel, 'development' locally
NODE_ENV=development

# ============================================================================
# PORT (Optional for local development)
# ============================================================================
# Not used in Vercel (serverless), but useful for local testing
PORT=5000

# ============================================================================
# NOTES FOR VERCEL DEPLOYMENT
# ============================================================================
#
# BACKEND (https://crimewise-web-v2-ri4n.vercel.app):
#   1. Set these env vars in Vercel dashboard under Settings > Environment Variables:
#      - DB_URL
#      - JWT_SECRET
#      - GEMINI_API_KEY
#      - GEMINI_API_KEY_1 through GEMINI_API_KEY_6
#      - AI_WORKER_CONCURRENCY (optional, default 6)
#      - AI_WORKER_POLL_MS (optional, default 2000)
#      - AI_WORKER_MAX_RETRIES (optional, default 3)
#
# FRONTEND (https://crimewise-web-v2.vercel.app):
#   1. No secrets needed - API calls use relative path /api
#   2. VITE_API_URL=/api (already set in .env.production)
#   3. Builds automatically from frontend/ directory
#
# RATE LIMITING:
#   - Each key: 10 RPM, 250 RPD (Google Gemini Free Plan)
#   - 6 keys × 8 RPM = 48 RPM (safe margin below 60 RPM limit)
#   - Min delay: 7.5 seconds between requests enforced in ai-worker.js
#
# MONITORING:
#   - GET /api/monitor/api-keys → Check API key utilization
#   - GET /api/monitor/ai-worker → Check queue depth and configuration
#   - GET /health → Check backend health
#   - GET /test → Test connectivity
#
# DATABASE KEEP-ALIVE:
#   - GitHub Actions workflow runs every 10 hours (see .github/workflows/keep-alive.yml)
#   - Pings /api/cron/keep-alive to prevent 12-hour SQLite Cloud sleep
#
# ============================================================================
