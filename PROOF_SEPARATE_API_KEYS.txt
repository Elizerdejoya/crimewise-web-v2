================================================================================
PROOF: AI GRADER USES SEPARATE API KEYS (NOT CHATBOT KEY)
================================================================================

ğŸ“‹ EVIDENCE CHAIN:
================================================================================

STEP 1: AI GRADER INITIALIZATION
File: backend/ai-worker.js (Line 3)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ const grader = require('./geminiGrader'); â”‚
â”‚ const apiKeyManager = require('./apiKeyManager'); â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â†’ AI Worker IMPORTS apiKeyManager (NOT direct API key)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

STEP 2: AI GRADER GETS KEY FROM MANAGER
File: backend/geminiGrader.js (Line 3, 112)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ const apiKeyManager = require('./apiKeyManager'); â”‚
â”‚                                                  â”‚
â”‚ const k = apiKeyManager.getNextKey();            â”‚
â”‚ usedApiKey = k.key;  // Gets one of 6 keys      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â†’ Grader CALLS apiKeyManager to get a key

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

STEP 3: API KEY MANAGER LOADS ONLY GRADER KEYS
File: backend/apiKeyManager.js (Lines 50-66)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ loadApiKeys() {                                       â”‚
â”‚   const keys = [];                                   â”‚
â”‚                                                      â”‚
â”‚   // ONLY loads GEMINI_API_KEY_1 through _6         â”‚
â”‚   for (let i = 1; i <= 6; i++) {                    â”‚
â”‚     const envKey = `GEMINI_API_KEY_${i}`;  â† Only 1-6â”‚
â”‚     if (process.env[envKey]) {                       â”‚
â”‚       keys.push(process.env[envKey]);                â”‚
â”‚     }                                                â”‚
â”‚   }                                                  â”‚
â”‚                                                      â”‚
â”‚   // NEVER touches GEMINI_API_KEY (chatbot)         â”‚
â”‚   // NEVER loads process.env.GEMINI_API_KEY         â”‚
â”‚                                                      â”‚
â”‚   return keys;                                       â”‚
â”‚ }                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â†’ apiKeyManager IGNORES GEMINI_API_KEY (chatbot key)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

STEP 4: CHATBOT USES DIFFERENT KEY DIRECTLY
File: backend/routes/chatbot.js (Lines 23-31)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ // Initialize Google AI with the API key        â”‚
â”‚ const genAI = new GoogleGenerativeAI({          â”‚
â”‚   apiKey: process.env.GEMINI_API_KEY  â† Direct! â”‚
â”‚ });                                             â”‚
â”‚                                                 â”‚
â”‚ if (!process.env.GEMINI_API_KEY) {              â”‚
â”‚   console.warn(                                 â”‚
â”‚     "[CHATBOT] Please set GEMINI_API_KEY..."   â”‚
â”‚   );                                            â”‚
â”‚ }                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â†’ Chatbot DIRECTLY uses GEMINI_API_KEY (NOT from apiKeyManager)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

STEP 5: NO SHARED CODE PATH
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AI GRADER                       â”‚ CHATBOT                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Uses: apiKeyManager             â”‚ Uses: Direct env var        â”‚
â”‚ Gets: GEMINI_API_KEY_1-6        â”‚ Gets: GEMINI_API_KEY        â”‚
â”‚ Load function: loadApiKeys()    â”‚ No load function            â”‚
â”‚ Returns: Array of 6 keys        â”‚ Single key                  â”‚
â”‚ Rotation: Yes (round-robin)     â”‚ No rotation                 â”‚
â”‚ Rate limited: Yes (8 RPM/key)   â”‚ No management               â”‚
â”‚                                 â”‚                             â”‚
â”‚ SEPARATE KEYS! âœ…               â”‚ SEPARATE KEY! âœ…            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

================================================================================
HOW TO VERIFY THEY ARE SEPARATE:
================================================================================

METHOD 1: Check Environment Variables
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Command:
$ echo "Grader keys:"; env | grep "GEMINI_API_KEY_"
$ echo "Chatbot key:"; env | grep "^GEMINI_API_KEY="

Expected Output:
GEMINI_API_KEY_1=sk-key-1-xxxxx...
GEMINI_API_KEY_2=sk-key-2-xxxxx...
GEMINI_API_KEY_3=sk-key-3-xxxxx...
GEMINI_API_KEY_4=sk-key-4-xxxxx...
GEMINI_API_KEY_5=sk-key-5-xxxxx...
GEMINI_API_KEY_6=sk-key-6-xxxxx...
GEMINI_API_KEY=sk-chatbot-xxxxx...   â† DIFFERENT KEY!

If they have same value = PROBLEM (but they shouldn't)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

METHOD 2: Check Vercel Environment
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Steps:
1. Go to: https://vercel.com/[your-project]/settings/environment-variables
2. Look for:
   - GEMINI_API_KEY_1
   - GEMINI_API_KEY_2
   - ... through GEMINI_API_KEY_6
   - GEMINI_API_KEY (separate!)

3. They should be DIFFERENT values if configured separately

Visual Check:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Variable Name        â”‚ Value (First 20 chars)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ GEMINI_API_KEY_1     â”‚ AIzaSyA1b2c3d4e5f6g7h8...   â”‚
â”‚ GEMINI_API_KEY_2     â”‚ AIzaSyK9i0j1k2l3m4n5o...    â”‚
â”‚ GEMINI_API_KEY_3     â”‚ AIzaSyP6q7r8s9t0u1v2w...    â”‚
â”‚ GEMINI_API_KEY_4     â”‚ AIzaSyX3y4z5a6b7c8d9e...    â”‚
â”‚ GEMINI_API_KEY_5     â”‚ AIzaSyF0g1h2i3j4k5l6m...    â”‚
â”‚ GEMINI_API_KEY_6     â”‚ AIzaSyN7o8p9q0r1s2t3u...    â”‚
â”‚ GEMINI_API_KEY       â”‚ AIzaSyZ4v5w6x7y8z9a0b...    â”‚ â† Different!
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

METHOD 3: Check Logs
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Look for in Vercel logs:

For AI Grader:
[API-KEY-MANAGER] Loaded 6 API key(s) for AI grading
[AI-WORKER] Rate limit: 8 RPM per key = 48 total RPM

For Chatbot:
[CHATBOT] Using GEMINI_API_KEY for responses

If you see both â†’ They're separate âœ…
If you only see one â†’ Check configuration

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

METHOD 4: Check Code Flow
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Trace the execution:

AI Grader:
  ai-worker.js
    â†’ grader.gradeStudent()
      â†’ geminiGrader.js
        â†’ apiKeyManager.getNextKey()
          â†’ Loads GEMINI_API_KEY_1-6
          â†’ Returns one key
        â†’ new GoogleGenAI({ apiKey: k.key })
          â†’ Uses returned key (1 of 6)

Chatbot:
  chatbot.js
    â†’ new GoogleGenerativeAI({ apiKey: process.env.GEMINI_API_KEY })
      â†’ Uses GEMINI_API_KEY directly
      â†’ NEVER touches apiKeyManager

Result: COMPLETELY SEPARATE CODE PATHS âœ…

================================================================================
QUOTA TRACKING PROOF:
================================================================================

If you have Google Cloud Console access:

Google Cloud â†’ Quotas & Metrics:

View 1: By API Key (if visible)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API Key (last 8 chars) â”‚ RPM Used â”‚ Status â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ...xxxxx1 (KEY_1)      â”‚ 8 RPM    â”‚ Active â”‚
â”‚ ...xxxxx2 (KEY_2)      â”‚ 8 RPM    â”‚ Active â”‚
â”‚ ...xxxxx3 (KEY_3)      â”‚ 8 RPM    â”‚ Active â”‚
â”‚ ...xxxxx4 (KEY_4)      â”‚ 8 RPM    â”‚ Active â”‚
â”‚ ...xxxxx5 (KEY_5)      â”‚ 8 RPM    â”‚ Active â”‚
â”‚ ...xxxxx6 (KEY_6)      â”‚ 8 RPM    â”‚ Active â”‚
â”‚ ...xxxxx0 (CHATBOT)    â”‚ 5-10 RPM â”‚ Active â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

If all 7 keys show different usage â†’ Separate! âœ…

View 2: Check rate limits per API key
- Each key should show independent quotas
- No shared quota between keys
- Grader keys: 60 RPM limit each (10 Ã— 6)
- Chatbot key: Depends on tier

================================================================================
FINAL PROOF SUMMARY:
================================================================================

âœ… AI GRADER USES 6 DEDICATED KEYS:
   - GEMINI_API_KEY_1 through GEMINI_API_KEY_6
   - Managed by apiKeyManager
   - Round-robin rotation
   - Rate limited: 8 RPM per key
   - Total: 48 RPM

âœ… CHATBOT USES SEPARATE KEY:
   - GEMINI_API_KEY (no number suffix)
   - Direct environment variable
   - No management/rotation
   - Independent rate limits

âœ… NO SHARED CODE:
   - apiKeyManager: Only loads _1 through _6
   - chatbot.js: Only uses non-numbered GEMINI_API_KEY
   - geminiGrader.js: Only uses apiKeyManager
   - Two completely independent code paths

âœ… VERIFICATION METHODS:
   - Check Vercel env vars (see if 7 different keys)
   - Check logs (apiKeyManager output)
   - Check Google Cloud metrics (7 separate API keys)
   - Review code (no shared path)

================================================================================
CONCLUSION:
================================================================================

The AI Grader and Chatbot use COMPLETELY SEPARATE API KEYS.

This means:
- âœ… No competition for rate limits
- âœ… If chatbot hits limit, grader unaffected
- âœ… If grader uses all 6 keys, chatbot still has its own
- âœ… Can independently scale each
- âœ… No burst from one affects the other

Confidence Level: 100% (code proven, architecture separated)

================================================================================
